<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  

  <title>Introducing Avatar-CLI</title>
  <meta name="description" content="These past weeks I’ve been working on a personal project calledAvatar-CLI, a cli tool meant to easethe usage of other containerized cli programs as if they were native.">
  <meta name="author" content="Andrés Correa Casablanca">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Introducing Avatar-CLI">
  <meta name="twitter:description" content="These past weeks I’ve been working on a personal project calledAvatar-CLI, a cli tool meant to easethe usage of other containerized cli programs as if they were native.">
  
  <meta name="twitter:creator" content="castarco">
  
  <meta name="twitter:image" content="https://blog.coderspirit.xyz//images/favicons/favicon-194x194.png" />

  <meta property="og:type" content="article">
  <meta property="og:title" content="Introducing Avatar-CLI">
  <meta property="og:description" content="These past weeks I’ve been working on a personal project calledAvatar-CLI, a cli tool meant to easethe usage of other containerized cli programs as if they were native.">
  <meta property="og:image" content="https://blog.coderspirit.xyz//images/favicons/favicon-194x194.png" />

  <link rel="apple-touch-icon" sizes="57x57" href="/images/favicons/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/images/favicons/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/images/favicons/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/images/favicons/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/images/favicons/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/images/favicons/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/images/favicons/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/images/favicons/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-194x194.png" sizes="194x194">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/images/favicons/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="/images/favicons/manifest.json">
  <link rel="shortcut icon" href="/images/favicons/favicon.ico">
  <meta name="msapplication-TileColor" content="#ffc40d">
  <meta name="msapplication-TileImage" content="/images/favicons/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <link rel="stylesheet" href="/css/main.css?1601151139428668491">
  <link rel="canonical" href="https://blog.coderspirit.xyz//blog/2020/08/22/introducing-avatar-cli/">
  <link rel="alternate" type="application/rss+xml" title="Coder Spirit" href="/feed.xml">
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({tex2jax: {inlineMath: [['¬€','€¬']]}});
  </script>
  <script type="text/javascript" async
          src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
</head>


  <body>
    <span class="mobile btn-mobile-menu">
  <i class="icon icon-list btn-mobile-menu__icon"></i>
  <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
</span>
  
<header class="panel-cover" style="background-image: url(/images/cover.jpg)">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">
        <a href="/" title="link to home of Coder Spirit">
          <img src="/images/profile.png" class="user-image" alt="My Profile Photo">
          <h1 class="panel-cover__title panel-title">Coder Spirit</h1>
        </a>
        <hr class="panel-cover__divider">
        <p class="panel-cover__description">I'm Andrés Correa Casablanca. I work as a software engineer, but I have a scientist in my heart. I love mathematics, algorithms, AI, and machine learning.
</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary">

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/#blog" title="link to Coder Spirit blog" class="blog-button">Blog</a></li>
            </ul>
          </nav>

          <nav class="cover-navigation navigation--social">
            <ul class="navigation">
          
            
              <!-- Twitter -->
              <li class="navigation__item">
                <a href="http://twitter.com/castarco" title="@castarco on Twitter" target="_blank">
                  <i class="icon icon-social-twitter"></i>
                  <span class="label">Twitter</span>
                </a>
              </li>
            

            
              <!-- LinkedIn -->
              <li class="navigation__item">
                <a href="https://www.linkedin.com/in/castarco" title="castarco on LinkedIn" target="_blank">
                  <i class="icon icon-social-linkedin"></i>
                  <span class="label">LinkedIn</span>
                </a>
              </li>
            

            
              <!-- GitHub -->
              <li class="navigation__item">
                <a href="https://www.github.com/castarco" title="castarco on GitHub" target="_blank">
                  <i class="icon icon-social-github"></i>
                  <span class="label">GitHub</span>
                </a>
              </li>
            

            
              <!-- Email -->
              <li class="navigation__item">
                <a href="mailto:contact@coderspirit.xyz" title="Email contact@coderspirit.xyz" target="_blank">
                  <i class="icon icon-mail"></i>
                  <span class="label">Email</span>
                </a>
              </li>
            

            <!-- RSS -->
            <li class="navigation__item">
              <a href="/feed.xml" title="Subscribe" target="_blank">
                <i class="icon icon-rss"></i>
                <span class="label">RSS</span>
              </a>
            </li>
          
            </ul>
          </nav>

        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>


    <div class="content-wrapper">
      <div class="content-wrapper__inner">
        <article class="post-container post-container--single">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="22 Aug 2020" class="post-meta__date date">22 Aug 2020</time>
      
      &#8226; <span class="post-meta__tags">on <a href="/tags/#Avatar-CLI">Avatar-CLI</a> <a href="/tags/#Docker">Docker</a> <a href="/tags/#Rust">Rust</a> <a href="/tags/#Tooling">Tooling</a> </span>
      
    </div>
    <h1 class="post-title">Introducing Avatar-CLI</h1>
  </header>

  <section class="post">
    <p>These past weeks I’ve been working on a personal project called
<a href="https://gitlab.com/avatar-cli/avatar-cli">Avatar-CLI</a>, a cli tool meant to ease
the usage of other containerized cli programs as if they were native.</p>

<p><img src="/images/2020/20200822_avatar_logo.png" alt="Avatar-CLI Logo" height="340px" width="340px" display="inline" align="left" margin="0px 0px" /></p>

<p>Why I felt the need for such kind of tool? Well, this idea came to me around 3
years ago, while I was working in a team where some developers were using Linux,
and others were using Macos. Our development environments were quite
heterogeneous, and it was common to see problems related to each of us having
different versions of the same tools in our systems. If you are interested on
the story, you can watch this
<a href="https://www.youtube.com/watch?v=zHuXnmmATHM">Youtube video</a> where I explain it.</p>

<p>So, let’s fast forward in time to now. Avatar-CLI is cross-platform, and
provides a single statically linked binary for each system that allows us to
pinpoint versions for the software we use in our development environments,
ensuring that all members in a team are using exactly the same software.</p>

<p>Avatar-CLI achieves its goals by relying on Docker. But as you would expect,
Docker is just one part of it. There are a lot of small challenges in order to
achieve a smooth developer experience; file permissions, integration with
<code class="language-plaintext highlighter-rouge">ssh-agent</code>, shell integration, being able to distinguish between interactive
and non-interactive modes, dealing with package manager caches, taking into
account that docker tags are mutable references…</p>

<h2 id="similar-projects">Similar projects</h2>

<p>Although by the time I came up with the idea of Avatar-CLI there was nothing
like that, I didn’t really start working on it after some years, and during that
time some tools with similar purposes appeared.</p>

<p><a href="https://github.com/kudulab/dojo">Dojo</a> is probably one of the most known tools
among the potential competitors of Avatar-CLI, and it even appeared in the
<a href="https://www.thoughtworks.com/radar/tools/dojo">ThoughtWorks Technology Radar</a>.
It has been developed in Go, and presents a different set of tradeoffs, more
specifically it imposes more requirements on the OCI images that can be used
with it, but it’s more mature on the side of supporting complex setups with
Docker Compose files.</p>

<p><a href="ttps://github.com/containers/toolbox">“Toolbox”</a> is a project mostly maintained
by RedHat developers which seems to be quite serious. Its main difference with
Avatar-CLI is that it uses a single “big” container that acts as a toolbox, with
everything installed inside; while Avatar-CLI creates different containers for
each program, and uses a non containerized subshell to expose those containers
as if they were native programs.</p>

<p>Another project worth of mention is the
<a href="https://nixos.org/">Nix package manager</a>, it shares our goal of having
predictable and well defined environments (and probably it does that better than
anyone else), but its ecosystem can’t compete with Docker’s one when it comes to
numbers.</p>

<h2 id="a-brief-demo">A brief demo</h2>

<p>If you want to see how it works, here there is a screencast I recorded a few
days ago:</p>

<script id="asciicast-353664" src="https://asciinema.org/a/353664.js" async=""></script>

<h2 id="how-im-developing-avatar-cli">How I’m developing Avatar-CLI</h2>

<p>There are many aspects that I would like to talk about, but I’ll try to
be succint here, and write down those things in other more specific blog posts.</p>

<h3 id="rust-as-the-main-language">Rust as the main language</h3>

<p>For Avatar-CLI I chose <a href="https://www.rust-lang.org/">Rust</a>, a strongly typed
language that compiles “native” binaries. One of the main reasons was the
ability to generate single statically linked binaries, a property that hugely
simplifies the installation and usage of Avatar-CLI, and decreases the chances
of suffering problems due to missing dependencies.</p>

<p>On that category of options, only C++ and <a href="https://golang.org/">Golang</a> were
considered as serious contenders, but the lack of memory safety of C++, and the
lack of strong typing of Golang pushed the balance in favour of Rust.</p>

<p>As an unexpected benefit, I discovered that Rust’s pattern matching was a very
powerful tool to ensure that I’m taking care of almost all relevant cases, which
helps me a lot to decrease the probability of suffering mysterious bugs.</p>

<h3 id="automation">Automation</h3>

<p>Besides the development of Avatar-CLI itself, I also had to automate many tasks
in the CI/CD pipelines. For that I chose
<a href="https://docs.gitlab.com/ee/ci/introduction/">Gitlab CI</a> (that allows me to
easily use Docker-in-Docker setups) and
<a href="https://www.typescriptlang.org/">Typescript</a>, that made very easy to write
powerful and flexible scripts to manage the pipelines and write some git hooks.</p>

<p>Version numbering is generated automatically based on commit messages, and once
the code reaches the <code class="language-plaintext highlighter-rouge">main</code> branch, a new release is generated (this includes
generating Linux binaries, creating a <a href="https://crates.io">crates.io</a> release and
pushing new OCI images to many registries).</p>

<h3 id="documentation">Documentation</h3>

<p>For Avatar-CLI I decided to have a
<a href="https://gitlab.com/avatar-cli/aips">specific repository for documentation</a>,
where AIP (Avatar Improvement Proposal) documents will be written, follwing a
similar process to what Bitcoin has in place with its BIPs.</p>

<p>Right now there isn’t too much stuff in there, as I focused almost all my
attention and energy on releasing something usable, but my aim is to be
exhaustive, in order to help new contributors to learn about the project
internals and why some decisions were made.</p>

<h3 id="the-roadmap">The roadmap</h3>

<p>Right now there is nothing written in stone, and most tasks are defined for the
near future, but you can see the short term plans in this
<a href="https://gitlab.com/avatar-cli/avatar-cli/-/boards">kanban board</a>.</p>

<p>There are other tasks that I have in mind and are not written there because they
belong to other related projects, like working on the website, or even writing
articles like this one talking about the project.</p>

<p>Having said that, if you want to be involved, please contact me and let me know,
I’m hoping that more people will join soon and transform Avatar-CLI into a
community project :) .</p>

  </section>
  <section id="disqus_thread"></section><!-- /#disqus_thread -->
</article>
<script type="text/javascript">
  var disqus_config = function () {
    this.page.url = 'https://blog.coderspirit.xyz/blog/2020/08/22/introducing-avatar-cli/';  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = '/blog/2020/08/22/introducing-avatar-cli'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
  };

  (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = '//coderspirit.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
   })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


      </div>

      <footer class="footer">
  <span class="footer__copyright">&copy; 2020 Andrés Correa Casablanca. All rights reserved.</span>
</footer>

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script type="text/javascript" src="/js/main.js?1601151139428668491"></script>


    </div>
  </body>
</html>